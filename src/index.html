<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="./output.css" rel="stylesheet">
    <!-- <script src="https://kit.fontawesome.com/8fd355cbc5.js" crossorigin="anonymous"></script> -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script> -->
  </head>
  <body class="bg-green-100 min-h-screen">
    <div class=" bg-white w-[90%] md:max-w-[680px] lg:max-w-[720px] shadow-md mx-auto py-12 my-16 rounded-2xl px-8">
        <header class="text-center mb-7 mt-3 md:mt-1">
            <strong class="text-2xl  md:text-3xl lg:text-3xl">Weather Forecast App</strong>
        </header>
        <main>
            <!-- searchbox-------------- -->
            <section class="text-center">
              <div class="flex gap-2 mt-4 relative">
                <input id="cityName" type="text" list="recentSearches" spellcheck="false" placeholder="Enter a City Name" class="w-full pl-3 border-[0.5px] border-gray-300 rounded-md focus:outline-none focus:border-2 focus:border-blue-500">
                <datalist id="recentSearches"></datalist>
                <button id="searchBtn" class="bg-blue-500 cursor-pointer  px-4 sm:px-8 py-2 rounded-md text-white font-semibold sm:font-bold">Search</button>
              </div>
              <div id="suggestions" class="absolute left-0 right-0 mt-1 border border-gray-200 rounded-lg bg-white shadow-sm hidden z-10"></div>
              <p class="text-center text-black mt-1">or</p>
              <button id="locationBtn" class="w-full cursor-pointer rounded-md bg-green-400 mt-1 px-8 py-2 text-white font-semibold sm:font-bold">Use Current Location</button>
              <div id="error" class="text-red-500 text-center mt-3"></div>
            </section>

            <!-- weather information display --------------  -->
             <section id="main-information" class="mt-12 hidden">
                <article>
                  <h1 class="font-bold text-2xl md:text-3xl text-center  text-[#6c6a6a]"></h1>
                  <p id="date" class="mx-auto text-[#6c6a6a] text-[12px] font-bold mt-1 text-center"></p>
                  <div>
                    <img id="mainImg" src="" alt="" class="mx-auto w-28 md:w-28">
                    <div class="text-center font-semibold text-[#6c6a6a] ">
                     <span id="weatherStatus" class="text-xl md:text-2xl"></span>
                     <span id="mainTemp" class="text-xl md:text-2xl"></span>
                    </div>
                    
                    <div class="flex flex-col sm:flex-row justify-center gap-1 sm:gap-4 mt-4 text-center ">
                      <div class="">
                        <i class="fa-solid fa-droplet text-[#807979]"></i>
                        <span id="humidity" class="text-[#6d6c6c] font-semibold">Humidity : 21 %</span>
                      </div>
                      <div class="">
                        <i class="fa-solid fa-wind ml-1.5 text-[#575555]"></i>
                        <span id="windSpeed" class="text-[#6d6c6c] font-semibold">Wind Speed : 21</span>
                      </div>
                    </div>

                  </div>
                </article>
                <hr class="mt-6">
                <article class="mt-6">
                  <h2 class="font-bold text-2xl text-center mb-8 text-[#6c6a6a]">5-Day Forecast</h2>
                  <div id="forecast5" class="flex gap-4 justify-center items-center flex-wrap">
                    <!-- <div class="text-center border border-gray-300 p-4 rounded-md bg-blue-50 shadow-md">
                      <p class="text-[#6c6a6a] font-bold">15 April 2025</p>
                      <img src="images/clear.png" alt="" class="w-16 mx-auto">
                      <p>Clear, 28 C</p>
                      <p>Humidity 50%</p>
                      <p>wind:5 km/hr</p>
                    </div> -->
                    
                    
                    
                    
                  </div>
                </article>
             </section>
        </main>
    </div>


    <script>




     // Manage Recent Searches
function updateRecentSearches(city) {
  let recent = JSON.parse(localStorage.getItem("recentCities")) || [];

  // Remove if already exists, then add to front
  recent = recent.filter(item => item.toLowerCase() !== city.toLowerCase());
  recent.unshift(city);

  // Keep only the latest 3
  recent = recent.slice(0, 3);

  localStorage.setItem("recentCities", JSON.stringify(recent));
  populateDatalist();
}

function populateDatalist() {
  const dataList = document.getElementById("recentSearches");
  dataList.innerHTML = "";

  const recent = JSON.parse(localStorage.getItem("recentCities")) || [];

  recent.forEach(city => {
    const option = document.createElement("option");
    option.value = city;
    dataList.appendChild(option);
  });
}








     

      apiKey="a692e3a8f846f51cc3ea078b252d8caa";

      function weatherDetailsByCityName(){
        document.querySelector("#error").innerHTML = "";
        const city = document.querySelector("#cityName").value.trim();
        if(!city){
          displayError("Plaese enter a city name");
          return;
        }
        getWeatherData(`https://api.openweathermap.org/data/2.5/forecast?q=${city}&appid=${apiKey}&units=metric`)
      }

      function weatherDetailByLocation() {
        document.querySelector("#error").innerHTML = "";
      if (!navigator.geolocation) {
        showError("Geolocation is not supported by your browser.");
        return;
      }
      navigator.geolocation.getCurrentPosition(
        position => {
          const { latitude, longitude } = position.coords;
          getWeatherData(`https://api.openweathermap.org/data/2.5/forecast?lat=${latitude}&lon=${longitude}&appid=${apiKey}&units=metric`);
        },
        () => displayError("Problem in fetching your location.")
      );
    }

      function getWeatherData(url) {
      fetch(url)
        .then(response => {
          if (!response.ok) throw new Error("Weather data not found.");
          return response.json();
        })
        .then(data => {
          
          showWeather(data);
          console.log(data);
          // console.log(data.list[0].weather[0].main);
          
          
        })
        .catch(error => {
          displayError(error.message);
        });
       }

      
     const searchBtn = document.querySelector("#searchBtn");
     const locationBtn = document.querySelector("#locationBtn");
    //  searchBtn.addEventListener("click",()=>{
    //     weatherDetailsByCityName();
    //  });


    searchBtn.addEventListener("click", () => {
  const city = document.querySelector("#cityName").value.trim();
  if (city) {
    updateRecentSearches(city);
    weatherDetailsByCityName();
  }
});


     locationBtn.addEventListener("click",()=>{
      weatherDetailByLocation();
     })  
     
     function changeImage(data){
      if(data.list[0].weather[0].main=="Clear"){
        document.querySelector("#mainImg").src ="images/clear.png";
      }
      else if(data.list[0].weather[0].main=="Clouds"){
        document.querySelector("#mainImg").src ="images/clouds.png";
      } 
      else if(data.list[0].weather[0].main=="Rain"){
        document.querySelector("#mainImg").src ="images/rain.png";
      }
      else if(data.list[0].weather[0].main=="drizzle"){
        document.querySelector("#mainImg").src ="images/drizzle.png";
      }
      else if(data.list[0].weather[0].main=="Mist"){
        document.querySelector("#mainImg").src ="images/mist.png";
      }
      
      }


      function changeImagePath(item){
      if(item.weather[0].main=="Clear"){
        return "images/clear.png";
      }
      else if(item.weather[0].main=="Clouds"){
        return "images/clouds.png";
      } 
      else if(item.weather[0].main=="Rain"){
        return "images/rain.png";
      }
      else if(item.weather[0].main=="drizzle"){
        return "images/drizzle.png";
      }
      else if(item.weather[0].main=="Mist"){
        return "images/mist.png";
      }
      
      }

    

     function showWeather(data){
      document.querySelector("#error").innerHTML = "";
      document.querySelector("#main-information").classList.remove("hidden");
      document.querySelector("#main-information h1").textContent = `${data.city.name }, ${data.city.country}`;
      document.querySelector("#date").textContent = `${new Date(data.list[0].dt_txt).toDateString()}`;
      changeImage(data);
      
      document.querySelector("#weatherStatus").textContent = `${data.list[0].weather[0].main}`;
      document.querySelector("#mainTemp").textContent =`${Math.round(data.list[0].main.temp)}¬∞C`;
      document.querySelector("#humidity").textContent = `Humidity : ${data.list[0].main.humidity}%`;
      document.querySelector("#windSpeed").textContent = `Wind : ${data.list[0].wind.speed} km/hr`;
      
      // 5 days forecast  
      const forecast5 = document.querySelector("#forecast5"); 
      forecast5.innerHTML = "";

      const forecastList = data.list.filter(item => item.dt_txt.includes("12:00:00"));
      console.log(forecastList);
      forecastList.slice(0,5).forEach(item=>{
        const element = document.createElement("div");
        let imgpath=changeImagePath(item);
        element.className = "text-center border border-gray-300 px-4 py-6 min-w-[250px] rounded-md bg-red-50 shadow-md";
        element.innerHTML = `
                      <p class="text-[#6c6a6a] font-bold">${new Date(item.dt_txt).toDateString()}</p>
                      <img id="forecastImg" src=${imgpath} alt="" class="w-20 mx-auto mt-2 -mb-1">
                      <p class="text-[#6c6a6a] font-semibold text-lg mb-3">${item.weather[0].main } , ${item.main.temp}¬∞C</p>
                      <p class="text-[#6d6c6c] font-semibold text-sm mb-1"><i class="fa-solid fa-droplet text-[#807979]"></i> Humidity : ${item.main.humidity}%</p>
                      <p class="text-[#6d6c6c] font-semibold text-sm"><i class="fa-solid fa-wind ml-1.5 text-[#575555] w-1"></i>Wind : ${item.wind.speed} km/hr</p>
                    `;
                    
        forecast5.appendChild(element);            
      })

      // forecastList.slice(0, 5).forEach(item => {
      //   const card = document.createElement("div");
      //   card.className = "bg-blue-200 rounded-xl p-4 shadow";

      //   card.innerHTML = `
      //     <p class="font-semibold">${new Date(item.dt_txt).toDateString()}</p>
      //     <p>üå°Ô∏è Temp: ${item.main.temp}¬∞C</p>
      //     <p>üå•Ô∏è Weather: ${item.weather[0].main}</p>
      //     <p>üíß Humidity: ${item.main.humidity}%</p>
      //   `;

      //   forecast5.appendChild(card);
      // });


     }
     function displayError(message){
        document.querySelector("#error").innerHTML = message;
        document.querySelector("#main-information").classList.add("hidden");
      }
      populateDatalist();
    </script>
  </body>
</html>
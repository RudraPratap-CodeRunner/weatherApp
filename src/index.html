<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="./output.css" rel="stylesheet">
    <script src="https://kit.fontawesome.com/8fd355cbc5.js" crossorigin="anonymous"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script> -->
  </head>
  <body class="bg-green-100 min-h-screen">
    <div class=" bg-white w-[90%] md:w-[70%] lg:max-w-[50%] shadow-md mx-auto py-6 mt-16 rounded-2xl px-8">
        <header class="text-center">
            <strong class="text-3xl font-bold mt-4">Weather Forecast App</strong>
        </header>
        <main>
            <!-- searchbox-------------- -->
            <section class="text-center">
              <div class="flex gap-2 mt-4">
                <input id="cityName" type="text" list="recentSearches" spellcheck="false" placeholder="Enter a City Name" class="w-full pl-3 border-[0.5px] border-gray-300 rounded-md focus:outline-none focus:border-2 focus:border-blue-500">
                <datalist id="recentSearches"></datalist>
                <button id="searchBtn" class="bg-blue-500 cursor-pointer px-8 py-2 rounded-md text-white font-bold">Search</button>
              </div>
              <p class="text-center text-black mt-1">or</p>
              <button id="locationBtn" class="w-full cursor-pointer rounded-md bg-green-400 mt-1 px-8 py-2 text-white font-bold">Use Current Location</button>
              <div id="error" class="text-red-500 text-center mt-3"></div>
            </section>

            <!-- weather information display --------------  -->
             <section id="main-information" class="mt-4 hidden">
                <article>
                  <h1 class="font-bold text-xl md:text-3xl text-center  text-[#6c6a6a]"></h1>
                  <p id="date" class="mx-auto text-[#6c6a6a] text-[12px] font-bold mt-1 text-center"></p>
                  <div>
                    <img id="mainImg" src="" alt="" class="mx-auto w-20 md:w-28">
                    <div class="text-center font-semibold text-[#6c6a6a] text-2xl">
                     <span id="weatherStatus"></span>
                     <span id="mainTemp"></span>
                    </div>
                    
                    <div class="flex justify-center gap-4 mt-2">
                      <div>
                        <i class="fa-solid fa-droplet text-[#807979]"></i>
                        <span id="humidity" class="text-[#6d6c6c] font-semibold">Humidity : 21 %</span>
                      </div>
                      <div>
                        <i class="fa-solid fa-wind ml-1.5 text-[#575555]"></i>
                        <span id="windSpeed" class="text-[#6d6c6c] font-semibold">Wind Speed : 21</span>
                      </div>
                    </div>

                  </div>
                </article>
                
             </section>
        </main>
    </div>


    <script>

     

      apiKey="a692e3a8f846f51cc3ea078b252d8caa";

      function weatherDetailsByCityName(){
        document.querySelector("#error").innerHTML = "";
        const city = document.querySelector("#cityName").value.trim();
        if(!city){
          displayError("Plaese enter a city name");
          return;
        }
        getWeatherData(`https://api.openweathermap.org/data/2.5/forecast?q=${city}&appid=${apiKey}&units=metric`)
      }

      function weatherDetailByLocation() {
        document.querySelector("#error").innerHTML = "";
      if (!navigator.geolocation) {
        showError("Geolocation is not supported by your browser.");
        return;
      }
      navigator.geolocation.getCurrentPosition(
        position => {
          const { latitude, longitude } = position.coords;
          getWeatherData(`https://api.openweathermap.org/data/2.5/forecast?lat=${latitude}&lon=${longitude}&appid=${apiKey}&units=metric`);
        },
        () => displayError("Problem in fetching your location.")
      );
    }

      function getWeatherData(url) {
      fetch(url)
        .then(response => {
          if (!response.ok) throw new Error("Weather data not found.");
          return response.json();
        })
        .then(data => {
          
          showWeather(data);
          console.log(data);
          console.log(data.list[0].weather[0].main);
        })
        .catch(error => {
          displayError(error.message);
        });
       }

      
     const searchBtn = document.querySelector("#searchBtn");
     const locationBtn = document.querySelector("#locationBtn");
     searchBtn.addEventListener("click",()=>{
        weatherDetailsByCityName();
     });
     locationBtn.addEventListener("click",()=>{
      weatherDetailByLocation();
     })  
     
     function changeImage(data){
      if(data.list[0].weather[0].main=="Clear"){
        document.querySelector("#mainImg").src ="images/clear.png";
      }
      else if(data.list[0].weather[0].main=="Clouds"){
        document.querySelector("#mainImg").src ="images/clouds.png";
      } 
      else if(data.list[0].weather[0].main=="Rain"){
        document.querySelector("#mainImg").src ="images/rain.png";
      }
      else if(data.list[0].weather[0].main=="drizzle"){
        document.querySelector("#mainImg").src ="images/drizzle.png";
      }
      else if(data.list[0].weather[0].main=="Mist"){
        document.querySelector("#mainImg").src ="images/mist.png";
      }
      
      }

    

     function showWeather(data){
      document.querySelector("#error").innerHTML = "";
      document.querySelector("#main-information").classList.remove("hidden");
      document.querySelector("#main-information h1").textContent = `${data.city.name }, ${data.city.country}`;
      document.querySelector("#date").textContent = `${new Date(data.list[0].dt_txt).toDateString()}`;
      changeImage(data);
      
      document.querySelector("#weatherStatus").textContent = `${data.list[0].weather[0].main}`;
      document.querySelector("#mainTemp").textContent =`${Math.round(data.list[0].main.temp)}Â°C`;
      document.querySelector("#humidity").textContent = `Humidity : ${data.list[0].main.humidity} %`;
      document.querySelector("#windSpeed").textContent = `Wind : ${data.list[0].wind.speed} km/hr`;
      
     }
     function displayError(message){
        document.querySelector("#error").innerHTML = message;
        document.querySelector("#main-information").classList.add("hidden");
      }
    </script>
  </body>
</html>
<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="./output.css" rel="stylesheet">
    <!-- <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script> -->
  </head>
  <body class="bg-green-100 min-h-screen">
    <div class=" bg-white w-[90%] md:w-[70%] lg:max-w-[50%] shadow-md mx-auto py-6 mt-16 rounded-2xl px-8">
        <header class="text-center">
            <strong class="text-3xl font-bold mt-4">Weather Forecast App</strong>
        </header>
        <main>
            <!-- searchbox-------------- -->
            <section class="text-center">
              <div class="flex gap-2 mt-4">
                <input id="cityName" type="text" spellcheck="false" placeholder="Enter a City Name" class="w-full pl-3 border-[0.5px] border-gray-300 rounded-md focus:outline-none focus:border-2 focus:border-blue-500">
                <button id="searchBtn" class="bg-blue-500 cursor-pointer px-8 py-2 rounded-md text-white font-bold">Search</button>
              </div>
              <p class="text-center text-black mt-1">or</p>
              <button id="locationBtn" class="w-full cursor-pointer rounded-md bg-green-400 mt-1 px-8 py-2 text-white font-bold">Use Current Location</button>
              <div id="error" class="text-red-500 text-center"></div>
            </section>

            <!-- weather information display --------------  -->
             <section id="main-information" class="mt-4">
                <h1 class="font-bold text-xl md:text-6xl text-center"></h1>
             </section>
        </main>
    </div>


    <script>
      apiKey="a692e3a8f846f51cc3ea078b252d8caa";

      function weatherDetailsByCityName(){
        const city = document.querySelector("#cityName").value.trim();
        if(!city){
          displayError("Plaese enter a city name");
          return;
        }
        getWeatherData(`https://api.openweathermap.org/data/2.5/forecast?q=${city}&appid=${apiKey}&units=metric`)
      }

      function weatherDetailByLocation() {
      if (!navigator.geolocation) {
        showError("Geolocation is not supported by your browser.");
        return;
      }
      navigator.geolocation.getCurrentPosition(
        position => {
          const { latitude, longitude } = position.coords;
          getWeatherData(`https://api.openweathermap.org/data/2.5/forecast?lat=${latitude}&lon=${longitude}&appid=${apiKey}&units=metric`);
        },
        () => displayError("Problem in fetching your location.")
      );
    }

      function getWeatherData(url) {
      fetch(url)
        .then(response => {
          if (!response.ok) throw new Error("Weather data not found.");
          return response.json();
        })
        .then(data => {
          showWeather(data);
          console.log(data);
          console.log(data.list[0].weather[0].main);
        })
        .catch(error => {
          displayError(error.message);
        });
       }

      function displayError(message){
        document.querySelector("#error").innerHTML = message;
      }
     const searchBtn = document.querySelector("#searchBtn");
     const locationBtn = document.querySelector("#locationBtn");
     searchBtn.addEventListener("click",()=>{
        weatherDetailsByCityName();
     });
     locationBtn.addEventListener("click",()=>{
      weatherDetailByLocation();
     })   

     function showWeather(data){
      document.querySelector("#main-information h1").textContent = `${data.city.name}, ${new Date(data.list[0].dt_txt).toDateString()}`;
      function changeImage(data){
        console.log(data.city.name);
      }
      changeImage(data);
     }
    </script>
  </body>
</html>